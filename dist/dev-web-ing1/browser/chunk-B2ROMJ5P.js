import{c as H,e as F,f as p,i as d,k as b,l as L,m as y}from"./chunk-NNRU5QZJ.js";import{S as j,X as I,a as c,c as n}from"./chunk-6CM4DDM5.js";var l=class{constructor(e=0,t="Network Error"){this.status=e,this.text=t}};var V=()=>{if(!(typeof localStorage>"u"))return{get:r=>Promise.resolve(localStorage.getItem(r)),set:(r,e)=>Promise.resolve(localStorage.setItem(r,e)),remove:r=>Promise.resolve(localStorage.removeItem(r))}};var i={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:V()};var g=r=>r?typeof r=="string"?{publicKey:r}:r.toString()==="[object Object]"?r:{}:{};var q=(r,e="https://api.emailjs.com")=>{if(!r)return;let t=g(r);i.publicKey=t.publicKey,i.blockHeadless=t.blockHeadless,i.storageProvider=t.storageProvider,i.blockList=t.blockList,i.limitRate=t.limitRate,i.origin=t.origin||e};var P=(s,o,...a)=>n(void 0,[s,o,...a],function*(r,e,t={}){let m=yield fetch(i.origin+r,{method:"POST",headers:t,body:e}),h=yield m.text(),u=new l(m.status,h);if(m.ok)return u;throw u});var w=(r,e,t)=>{if(!r||typeof r!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||typeof e!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};var B=r=>{if(r&&r.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"};var v=r=>r.webdriver||!r.languages||r.languages.length===0;var k=()=>new l(451,"Unavailable For Headless Browser");var _=(r,e)=>{if(!Array.isArray(r))throw"The BlockList list has to be an array";if(typeof e!="string")throw"The BlockList watchVariable has to be a string"};var M=r=>!r.list?.length||!r.watchVariable,A=(r,e)=>r instanceof FormData?r.get(e):r[e],T=(r,e)=>{if(M(r))return!1;_(r.list,r.watchVariable);let t=A(e,r.watchVariable);return typeof t!="string"?!1:r.list.includes(t)};var R=()=>new l(403,"Forbidden");var N=(r,e)=>{if(typeof r!="number"||r<0)throw"The LimitRate throttle has to be a positive number";if(e&&typeof e!="string")throw"The LimitRate ID has to be a non-empty string"};var W=(r,e,t)=>n(void 0,null,function*(){let s=Number((yield t.get(r))||0);return e-Date.now()+s}),E=(r,e,t)=>n(void 0,null,function*(){if(!e.throttle||!t)return!1;N(e.throttle,e.id);let s=e.id||r;return(yield W(s,e.throttle,t))>0?!0:(yield t.set(s,Date.now().toString()),!1)});var x=()=>new l(429,"Too Many Requests");var O=(r,e,t,s)=>n(void 0,null,function*(){let o=g(s),a=o.publicKey||i.publicKey,m=o.blockHeadless||i.blockHeadless,h=o.storageProvider||i.storageProvider,u=c(c({},i.blockList),o.blockList),U=c(c({},i.limitRate),o.limitRate);return m&&v(navigator)?Promise.reject(k()):(w(a,r,e),B(t),t&&T(u,t)?Promise.reject(R()):(yield E(location.pathname,U,h))?Promise.reject(x()):P("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:a,service_id:r,template_id:e,template_params:t}),{"Content-type":"application/json"}))});var K=r=>{if(!r||r.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"};var $=r=>typeof r=="string"?document.querySelector(r):r,D=(r,e,t,s)=>n(void 0,null,function*(){let o=g(s),a=o.publicKey||i.publicKey,m=o.blockHeadless||i.blockHeadless,h=i.storageProvider||o.storageProvider,u=c(c({},i.blockList),o.blockList),U=c(c({},i.limitRate),o.limitRate);if(m&&v(navigator))return Promise.reject(k());let S=$(t);w(a,r,e),K(S);let f=new FormData(S);return T(u,f)?Promise.reject(R()):(yield E(location.pathname,U,h))?Promise.reject(x()):(f.append("lib_version","4.4.1"),f.append("service_id",r),f.append("template_id",e),f.append("user_id",a),P("/api/v1.0/email/send-form",f))});var C={init:q,send:O,sendForm:D,EmailJSResponseStatus:l};var J=class r{constructor(e){this.firestore=e}currentUser="visiteur";loggedInEmail=null;setUser(e){this.currentUser=e,localStorage.setItem("userType",e)}getUser(){return localStorage.getItem("userType")||"visiteur"}is(e){return this.getUser()===e}logout(){localStorage.removeItem("userType"),this.currentUser="visiteur",this.loggedInEmail=null}login(e,t){return n(this,null,function*(){let s=p(this.firestore,"users"),o=b(s,y("email","==",e.trim().toLowerCase())),a=yield d(o);if(a.empty)return!1;let m=a.docs[0].data();return m.password!==t?!1:(this.setUser(m.role),this.loggedInEmail=m.email,!0)})}getCurrentProfile(){return n(this,null,function*(){if(!this.loggedInEmail)return null;let e=p(this.firestore,"users"),t=b(e,y("email","==",this.loggedInEmail)),s=yield d(t);return s.empty?null:s.docs[0].data()})}getPublicProfiles(){return n(this,null,function*(){let e=p(this.firestore,"users");return(yield d(e)).docs.map(s=>{let o=s.data();return{pseudonym:o.pseudonym,gender:o.gender,birthdate:o.birthdate,memberType:o.memberType,profilePhoto:o.profilePhoto}})})}addUserFromCandidature(e,t,s){return n(this,null,function*(){let o={email:e.email,password:"default123",role:t,roomNumber:s,name:e.prenom,surname:e.nom,pseudonym:e.pseudo,gender:e.genre,birthdate:e.dateNaissance,memberType:e.typeMembre,profilePhoto:`https://i.pravatar.cc/150?u=${e.email}`},a=p(this.firestore,"users");yield F(a,o),C.send("service_c2dotqs","template_nhv7wck",{prenom:e.prenom,nom:e.nom,email:e.email},"U2hjDBr6kS44aib0b").then(()=>console.log("\u2705 Email sent")).catch(m=>console.error("\u274C Error sending email:",m))})}updatePassword(e){return n(this,null,function*(){if(!this.loggedInEmail)return;let t=p(this.firestore,"users"),s=b(t,y("email","==",this.loggedInEmail)),o=yield d(s);if(o.empty)return;let a=o.docs[0].ref;yield L(a,{password:e}),console.log("\u{1F510} Password updated in Firestore")})}updatePrivateInfo(e){return n(this,null,function*(){if(!this.loggedInEmail)return;let t=p(this.firestore,"users"),s=b(t,y("email","==",this.loggedInEmail)),o=yield d(s);if(o.empty)return;let a=o.docs[0].ref;yield L(a,e),console.log("\u{1F4DD} Private profile info updated")})}getTakenRooms(){return n(this,null,function*(){let e=p(this.firestore,"users"),t=yield d(e),s=[];return t.docs.forEach(o=>{let a=o.data();a.roomNumber!==null&&a.roomNumber!==void 0&&s.push(a.roomNumber)}),s})}getAvailableRooms(){return n(this,null,function*(){let e=yield this.getTakenRooms();return Array.from({length:10},(s,o)=>o+1).filter(s=>!e.includes(s))})}static \u0275fac=function(t){return new(t||r)(I(H))};static \u0275prov=j({token:r,factory:r.\u0275fac,providedIn:"root"})};export{J as a};
