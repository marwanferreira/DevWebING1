import{A as u,D as f,G as b,H as w,I as y,w as H,z as F}from"./chunk-HQUAAR4S.js";import{Y as j,a as l,ba as I,e as n}from"./chunk-XZRIOFSC.js";var c=class{constructor(t=0,r="Network Error"){this.status=t,this.text=r}};var N=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}};var i={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:N()};var h=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{};var V=(e,t="https://api.emailjs.com")=>{if(!e)return;let r=h(e);i.publicKey=r.publicKey,i.blockHeadless=r.blockHeadless,i.storageProvider=r.storageProvider,i.blockList=r.blockList,i.limitRate=r.limitRate,i.origin=r.origin||t};var P=(s,o,...a)=>n(void 0,[s,o,...a],function*(e,t,r={}){let m=yield fetch(i.origin+e,{method:"POST",headers:r,body:t}),p=yield m.text(),d=new c(m.status,p);if(m.ok)return d;throw d});var v=(e,t,r)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||typeof r!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};var _=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"};var k=e=>e.webdriver||!e.languages||e.languages.length===0;var T=()=>new c(451,"Unavailable For Headless Browser");var q=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"};var A=e=>!e.list?.length||!e.watchVariable,M=(e,t)=>e instanceof FormData?e.get(t):e[t],R=(e,t)=>{if(A(e))return!1;q(e.list,e.watchVariable);let r=M(t,e.watchVariable);return typeof r!="string"?!1:e.list.includes(r)};var U=()=>new c(403,"Forbidden");var B=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"};var W=(e,t,r)=>n(void 0,null,function*(){let s=Number((yield r.get(e))||0);return t-Date.now()+s}),S=(e,t,r)=>n(void 0,null,function*(){if(!t.throttle||!r)return!1;B(t.throttle,t.id);let s=t.id||e;return(yield W(s,t.throttle,r))>0?!0:(yield r.set(s,Date.now().toString()),!1)});var x=()=>new c(429,"Too Many Requests");var O=(e,t,r,s)=>n(void 0,null,function*(){let o=h(s),a=o.publicKey||i.publicKey,m=o.blockHeadless||i.blockHeadless,p=o.storageProvider||i.storageProvider,d=l(l({},i.blockList),o.blockList),E=l(l({},i.limitRate),o.limitRate);return m&&k(navigator)?Promise.reject(T()):(v(a,e,t),_(r),r&&R(d,r)?Promise.reject(U()):(yield S(location.pathname,E,p))?Promise.reject(x()):P("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:a,service_id:e,template_id:t,template_params:r}),{"Content-type":"application/json"}))});var D=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"};var $=e=>typeof e=="string"?document.querySelector(e):e,K=(e,t,r,s)=>n(void 0,null,function*(){let o=h(s),a=o.publicKey||i.publicKey,m=o.blockHeadless||i.blockHeadless,p=i.storageProvider||o.storageProvider,d=l(l({},i.blockList),o.blockList),E=l(l({},i.limitRate),o.limitRate);if(m&&k(navigator))return Promise.reject(T());let L=$(r);v(a,e,t),D(L);let g=new FormData(L);return R(d,g)?Promise.reject(U()):(yield S(location.pathname,E,p))?Promise.reject(x()):(g.append("lib_version","4.4.1"),g.append("service_id",e),g.append("template_id",t),g.append("user_id",a),P("/api/v1.0/email/send-form",g))});var C={init:V,send:O,sendForm:K,EmailJSResponseStatus:c};var J=class e{constructor(t){this.firestore=t}currentUser="visiteur";loggedInEmail=null;setUser(t){this.currentUser=t,localStorage.setItem("userType",t)}getUser(){return localStorage.getItem("userType")||"visiteur"}getUserProfile(){return JSON.parse(localStorage.getItem("userProfile")||"{}")}is(t){return this.getUser()===t}logout(){localStorage.removeItem("userType"),this.currentUser="visiteur",this.loggedInEmail=null}login(t,r){return n(this,null,function*(){let s=u(this.firestore,"users"),o=b(s,y("email","==",t.trim().toLowerCase())),a=yield f(o);if(a.empty)return!1;let m=a.docs[0],p=m.data();if(p.password!==r)return!1;let d=(p.points||0)+1;return yield w(m.ref,{points:d}),this.setUser(p.role),this.loggedInEmail=p.email,console.log("User logged in:",p),console.log("Stored User Type:",localStorage.getItem("userType")),!0})}getCurrentProfile(){return n(this,null,function*(){if(!this.loggedInEmail)return null;let t=u(this.firestore,"users"),r=b(t,y("email","==",this.loggedInEmail)),s=yield f(r);if(s.empty)return null;let o=s.docs[0];return l({uid:o.id},o.data())})}getPublicProfiles(){return n(this,null,function*(){let t=u(this.firestore,"users");return(yield f(t)).docs.map(s=>{let o=s.data();return{pseudonym:o.pseudonym,gender:o.gender,birthdate:o.birthdate,memberType:o.memberType,roomNumber:o.roomNumber,photoURL:o.photoURL||"https://www.w3schools.com/howto/img_avatar.png"}})})}addUserFromCandidature(t,r,s){return n(this,null,function*(){let o={email:t.email,password:"default123",role:r,roomNumber:s,name:t.prenom,surname:t.nom,pseudonym:t.pseudo,gender:t.genre,birthdate:t.dateNaissance,memberType:"R\xE9sident",profilePhoto:`https://i.pravatar.cc/150?u=${t.email}`,photoURL:"https://www.w3schools.com/howto/img_avatar.png",points:0,level:"d\xE9butant"},a=u(this.firestore,"users");yield F(a,o),C.send("service_c2dotqs","template_nhv7wck",{prenom:t.prenom,nom:t.nom,email:t.email},"U2hjDBr6kS44aib0b").then(()=>console.log("\u2705 Email sent")).catch(m=>console.error("\u274C Error sending email:",m))})}updatePassword(t){return n(this,null,function*(){if(!this.loggedInEmail)return;let r=u(this.firestore,"users"),s=b(r,y("email","==",this.loggedInEmail)),o=yield f(s);if(o.empty)return;let a=o.docs[0].ref;yield w(a,{password:t}),console.log("\u{1F510} Password updated in Firestore")})}updatePrivateInfo(t){return n(this,null,function*(){if(!this.loggedInEmail)return;let r=u(this.firestore,"users"),s=b(r,y("email","==",this.loggedInEmail)),o=yield f(s);if(o.empty)return;let a=o.docs[0].ref;yield w(a,t),console.log("\u{1F4DD} Private profile info updated")})}getTakenRooms(){return n(this,null,function*(){let t=u(this.firestore,"users"),r=yield f(t),s=[];return r.docs.forEach(o=>{let a=o.data();a.roomNumber!==null&&a.roomNumber!==void 0&&s.push(a.roomNumber)}),s})}getAvailableRooms(){return n(this,null,function*(){let t=yield this.getTakenRooms();return Array.from({length:10},(s,o)=>o+1).filter(s=>!t.includes(s))})}static \u0275fac=function(r){return new(r||e)(I(H))};static \u0275prov=j({token:e,factory:e.\u0275fac,providedIn:"root"})};export{J as a};
