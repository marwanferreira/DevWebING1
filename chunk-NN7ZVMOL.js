import{a as ee}from"./chunk-WNRD6OGO.js";import{a as q}from"./chunk-ZDOUOYXW.js";import{a as z,b as H,e as J,g as K,h as Q,i as X,j as Y,l as Z}from"./chunk-ZAQOZOOT.js";import{A as P,B as L,C as S,D as R,H as E,w as B}from"./chunk-HQUAAR4S.js";import{Eb as M,Fb as D,Gb as N,Hb as $,Ka as a,Oa as y,Ua as O,Ya as g,a as I,cc as U,db as m,dc as A,e as f,fc as W,gb as o,hb as t,hc as j,ib as V,jb as w,ka as u,kb as x,la as _,lb as c,qb as G,rb as n,sb as F,tb as p,ub as T,vb as k,xb as C,yb as v,zb as b}from"./chunk-XZRIOFSC.js";function ie(s,i){if(s&1&&(o(0,"option",21),n(1),t()),s&2){let e=i.$implicit;m("value",e),a(),p(" Chambre ",e," ")}}function ne(s,i){if(s&1){let e=w();o(0,"div",8)(1,"h5"),n(2),t(),o(3,"p")(4,"strong"),n(5,"Email :"),t(),n(6),t(),o(7,"p")(8,"strong"),n(9,"Date de naissance :"),t(),n(10),M(11,"date"),t(),o(12,"p")(13,"strong"),n(14,"Genre :"),t(),n(15),t(),o(16,"p")(17,"strong"),n(18,"Type de membre :"),t(),n(19),t(),o(20,"p")(21,"strong"),n(22,"Motivation :"),t(),n(23),t(),o(24,"div",9)(25,"div",10)(26,"label",11),n(27,"R\xF4le"),t(),o(28,"select",12),b("ngModelChange",function(l){let d=u(e).$implicit,h=c(2);return v(h.selectedRole[d.email],l)||(h.selectedRole[d.email]=l),_(l)}),o(29,"option",13),n(30,"S\xE9lectionner un r\xF4le"),t(),o(31,"option",14),n(32,"Simple"),t(),o(33,"option",15),n(34,"Complexe"),t(),o(35,"option",16),n(36,"Admin"),t()()(),o(37,"div",10)(38,"label",11),n(39,"Chambre"),t(),o(40,"select",12),b("ngModelChange",function(l){let d=u(e).$implicit,h=c(2);return v(h.selectedRoom[d.email],l)||(h.selectedRoom[d.email]=l),_(l)}),o(41,"option",13),n(42,"Attribuer une chambre"),t(),g(43,ie,2,2,"option",17),t()(),o(44,"div",18)(45,"button",19),x("click",function(){let l=u(e).$implicit,d=c(2);return _(d.approve(l))}),n(46,"\u2705 Accepter"),t(),o(47,"button",20),x("click",function(){let l=u(e).$implicit,d=c(2);return _(d.reject(l))}),n(48,"\u274C Rejeter"),t()()()()}if(s&2){let e=i.$implicit,r=c(2);a(2),T("",e.prenom," ",e.nom,""),a(4),p(" ",e.email,""),a(4),p(" ",D(11,12,e.dateNaissance),""),a(5),p(" ",e.genre,""),a(4),p(" ",e.typeMembre,""),a(4),p(" ",e.motivation,""),a(5),C("ngModel",r.selectedRole[e.email]),a(),m("ngValue",null),a(11),C("ngModel",r.selectedRoom[e.email]),a(),m("ngValue",null),a(2),m("ngForOf",r.getAvailableRooms())}}function oe(s,i){if(s&1&&(o(0,"div"),g(1,ne,49,14,"div",5),t()),s&2){let e=c();a(),m("ngForOf",e.candidatures)}}function re(s,i){s&1&&(o(0,"p",22),n(1,"Aucune candidature courante."),t())}function ae(s,i){if(s&1){let e=w();o(0,"span")(1,"input",28),b("ngModelChange",function(l){u(e);let d=c().$implicit;return v(d.points,l)||(d.points=l),_(l)}),x("change",function(){u(e);let l=c().$implicit,d=c();return _(d.updatePoints(l))}),t()()}if(s&2){let e=c().$implicit;a(),C("ngModel",e.points)}}function le(s,i){if(s&1&&(o(0,"span"),n(1),t()),s&2){let e=c().$implicit;a(),p(" ",e.points," ")}}function se(s,i){if(s&1&&(o(0,"option",21),n(1),t()),s&2){let e=i.$implicit;m("value",e),a(),p(" Chambre ",e," ")}}function de(s,i){if(s&1){let e=w();o(0,"div",8)(1,"h5"),n(2),t(),o(3,"p")(4,"strong"),n(5,"Pseudo:"),t(),n(6),t(),o(7,"p")(8,"strong"),n(9,"R\xF4le:"),t(),n(10),t(),o(11,"p")(12,"strong"),n(13,"Chambre:"),t(),n(14),t(),o(15,"p")(16,"strong"),n(17,"Points:"),t(),g(18,ae,2,1,"span",23)(19,le,2,1,"span",23),t(),o(20,"div",24)(21,"div",10)(22,"label",11),n(23,"Changer le r\xF4le"),t(),o(24,"select",25),b("ngModelChange",function(l){let d=u(e).$implicit;return v(d.role,l)||(d.role=l),_(l)}),x("change",function(){let l=u(e).$implicit,d=c();return _(d.updateRole(l))}),o(25,"option",14),n(26,"Simple"),t(),o(27,"option",15),n(28,"Complexe"),t(),o(29,"option",16),n(30,"Admin"),t()()(),o(31,"div",10)(32,"label",11),n(33,"Changer la chambre"),t(),o(34,"select",25),b("ngModelChange",function(l){let d=u(e).$implicit;return v(d.roomNumber,l)||(d.roomNumber=l),_(l)}),x("change",function(){let l=u(e).$implicit,d=c();return _(d.updateRoom(l))}),g(35,se,2,2,"option",17),t()(),o(36,"div",26)(37,"button",27),x("click",function(){let l=u(e).$implicit,d=c();return _(d.deleteUser(l))}),n(38,"\u{1F5D1}\uFE0F Supprimer"),t()()()()}if(s&2){let e=i.$implicit,r=c();a(2),k("",e.name," ",e.surname," \u2014 ",e.email,""),a(4),p(" ",e.pseudonym,""),a(4),p(" ",e.role,""),a(4),p(" ",e.roomNumber,""),a(4),m("ngIf",(r.profile==null?null:r.profile.role)==="admin"&&e.role!=="admin"),a(),m("ngIf",e.role==="admin"||(r.profile==null?null:r.profile.role)!=="admin"),a(5),C("ngModel",e.role),m("disabled",e.role==="admin"),a(10),C("ngModel",e.roomNumber),m("disabled",e.role==="admin"),a(),m("ngForOf",r.getAvailableRooms()),a(2),m("disabled",e.role==="admin")}}function me(s,i){if(s&1&&(o(0,"div",29)(1,"h3"),n(2),t(),o(3,"p")(4,"strong"),n(5,"Signal\xE9 par :"),t(),n(6),t(),o(7,"p")(8,"strong"),n(9,"Description :"),t(),n(10),t(),o(11,"p")(12,"strong"),n(13,"Date :"),t(),n(14),M(15,"date"),t()()),s&2){let e=i.$implicit;a(2),F(e.deviceName),a(4),p(" ",e.reportedBy,""),a(4),p(" ",e.description,""),a(4),p(" ",N(15,4,e.timestamp,"short"),"")}}var te=class s{constructor(i,e,r){this.applicationService=i;this.userService=e;this.firestore=r}candidatures=[];residents=[];profile=null;reports=[];selectedRole={};selectedRoom={};takenRooms=[];ngOnInit(){return f(this,null,function*(){this.profile=yield this.userService.getCurrentProfile(),this.candidatures=yield this.applicationService.getCandidatures(),this.takenRooms=yield this.userService.getTakenRooms(),yield this.loadResidents(),yield this.loadReports()})}loadResidents(){return f(this,null,function*(){let i=P(this.firestore,"users"),e=yield R(i);this.residents=e.docs.map(r=>I({uid:r.id},r.data())).filter(r=>r.role!=="visiteur")})}getAvailableRooms(){return Array.from({length:10},(e,r)=>r+1).filter(e=>!this.takenRooms.includes(e))}approve(i){return f(this,null,function*(){let e=this.selectedRole[i.email],r=this.selectedRoom[i.email];if(!e){alert("Merci de s\xE9lectionner un r\xF4le.");return}if(!r){alert("Merci de s\xE9lectionner une chambre disponible.");return}if(this.takenRooms.includes(r)){alert("Cette chambre est d\xE9j\xE0 attribu\xE9e.");return}yield this.userService.addUserFromCandidature(i,e,r),yield this.applicationService.deleteCandidature(i.id),this.takenRooms.push(r),alert(`\u2705 ${i.nom} a \xE9t\xE9 accept\xE9 avec le r\xF4le ${e} en chambre ${r}.`),yield this.ngOnInit()})}reject(i){return f(this,null,function*(){yield this.applicationService.deleteCandidature(i.id),alert(`\u274C Candidature de ${i.nom} rejet\xE9e.`),yield this.ngOnInit()})}updateRole(i){return f(this,null,function*(){if(!i.uid)return;let e=S(this.firestore,"users",i.uid);yield E(e,{role:i.role}),alert(`\u{1F504} R\xF4le mis \xE0 jour pour ${i.pseudonym}`)})}updateRoom(i){return f(this,null,function*(){if(!i.uid)return;let e=S(this.firestore,"users",i.uid);yield E(e,{roomNumber:i.roomNumber}),alert(`\u{1F3E0} Chambre mise \xE0 jour pour ${i.pseudonym}`)})}updatePoints(i){return f(this,null,function*(){if(!i.uid)return;let e=S(this.firestore,"users",i.uid);yield E(e,{points:i.points}),alert(`\u{1F504} Points mis \xE0 jour pour ${i.pseudonym}`)})}deleteUser(i){return f(this,null,function*(){if(!i.uid||!confirm(`\xCAtes-vous s\xFBr de vouloir supprimer ${i.pseudonym} ?`))return;let r=S(this.firestore,"users",i.uid);yield L(r),alert(`\u{1F5D1}\uFE0F ${i.pseudonym} supprim\xE9.`),yield this.ngOnInit()})}loadReports(){return f(this,null,function*(){let i=P(this.firestore,"device-reports"),e=yield R(i);this.reports=e.docs.map(r=>r.data())})}static \u0275fac=function(e){return new(e||s)(y(ee),y(q),y(B))};static \u0275cmp=O({type:s,selectors:[["app-gestion-candidatures"]],decls:13,vars:4,consts:[["noCandidatures",""],[1,"text-custom-blue"],[4,"ngIf","ngIfElse"],[1,"my-5"],[1,"mb-4"],["class","card mb-3 p-3",4,"ngFor","ngForOf"],[1,"reports-section"],["class","report-card",4,"ngFor","ngForOf"],[1,"card","mb-3","p-3"],[1,"d-flex","flex-column","flex-md-row","align-items-start","gap-2","mt-3"],[1,"flex-fill"],[1,"form-label"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],["value","simple"],["value","complexe"],["value","admin"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex","gap-2","mt-2","mt-md-4"],[1,"btn","btn-success",3,"click"],[1,"btn","btn-danger",3,"click"],[3,"value"],[1,"text-muted","fst-italic"],[4,"ngIf"],[1,"d-flex","flex-column","flex-md-row","gap-3","mt-3"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[1,"d-flex","align-items-end"],[1,"btn","btn-danger",3,"click","disabled"],["type","number",3,"ngModelChange","change","ngModel"],[1,"report-card"]],template:function(e,r){if(e&1&&(o(0,"h2",1),n(1,"Gestion des candidatures"),t(),g(2,oe,2,1,"div",2)(3,re,2,0,"ng-template",null,0,$),V(5,"hr",3),o(6,"h2",4),n(7,"Gestion des r\xE9sidents"),t(),g(8,de,39,14,"div",5),o(9,"div",6)(10,"h2"),n(11,"Signalement Objets"),t(),g(12,me,16,7,"div",7),t()),e&2){let l=G(4);a(2),m("ngIf",r.candidatures.length>0)("ngIfElse",l),a(6),m("ngForOf",r.residents),a(4),m("ngForOf",r.reports)}},dependencies:[j,U,A,W,Z,X,Y,z,K,Q,H,J],styles:["h2[_ngcontent-%COMP%]{color:#004080;font-weight:700;margin-bottom:20px}.card[_ngcontent-%COMP%]{background-color:#f0f8ff;border:1px solid #cce7ff;border-radius:8px;box-shadow:0 4px 8px #0000001a;padding:20px;margin-bottom:20px}.form-label[_ngcontent-%COMP%]{color:#004080;font-weight:700}.form-select[_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{border:1px solid #cce7ff;border-radius:4px;padding:8px;width:100%;background-color:#e6f2ff}.btn-success[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff;color:#fff}.btn-danger[_ngcontent-%COMP%]{background-color:#ff4d4d;border-color:#ff4d4d;color:#fff}.btn[_ngcontent-%COMP%]{border-radius:4px;padding:10px 20px;margin-top:10px}.text-muted[_ngcontent-%COMP%]{color:#6c757d}.fst-italic[_ngcontent-%COMP%]{font-style:italic}.d-flex[_ngcontent-%COMP%]{display:flex}.flex-fill[_ngcontent-%COMP%]{flex:1}.gap-2[_ngcontent-%COMP%]{gap:10px}.gap-3[_ngcontent-%COMP%]{gap:15px}.mt-3[_ngcontent-%COMP%]{margin-top:15px}.mb-3[_ngcontent-%COMP%]{margin-bottom:15px}.p-3[_ngcontent-%COMP%]{padding:15px}"]})};export{te as a};
